#!/usr/bin/perl -w

use esmith::Build::CreateLinks  qw(:all);
use File::Path;

#--------------------------------------------------
# service links for cupsd
#--------------------------------------------------
$service = "cupsd";

service_link_enhanced($service, "S90", "7");

#--------------------------------------------------
# service links for cups-lpd
#--------------------------------------------------
$service = "cups-lpd";

service_link_enhanced($service, "S95", "7");

#--------------------------------------------------
# actions for printer-sync event
#--------------------------------------------------

$event = "printer-sync";

event_link("cups-create-db", $event, "00");
event_link("cups-symlink-ppds", $event, "95");
event_link("cups-update-timestamp", $event, "95");
safe_symlink("sigterm", "root/etc/e-smith/events/$event/services2adjust/smbd");

#--------------------------------------------------
# actions for network-create event
#--------------------------------------------------

$event = "network-create";

templates2events("/etc/cups/cupsd.conf", $event);
safe_symlink("sighup", "root/etc/e-smith/events/$event/services2adjust/cupsd");

#--------------------------------------------------
# actions for network-delete event
#--------------------------------------------------

$event = "network-delete";

templates2events("/etc/cups/cupsd.conf", $event);
safe_symlink("sighup", "root/etc/e-smith/events/$event/services2adjust/cupsd");

#--------------------------------------------------
# actions for bootstrap-console-save event
#--------------------------------------------------

$event = "bootstrap-console-save";

templates2events("/etc/logrotate.d/cups", $event);
templates2events("/etc/cups/mime.convs", $event);
templates2events("/etc/cups/mime.types", $event);
templates2events("/etc/cups/cupsd.conf", $event);

#--------------------------------------------------
# actions for console-save event
#--------------------------------------------------

$event = "console-save";

templates2events("/etc/cups/cupsd.conf", $event);
safe_symlink("sighup", "root/etc/e-smith/events/$event/services2adjust/cupsd");

#--------------------------------------------------
# actions for cups-reconfigure event
#--------------------------------------------------

$event = "cups-reconfigure";

templates2events("/etc/cups/cupsd.conf", $event);
safe_symlink("sighup", "root/etc/e-smith/events/$event/services2adjust/cupsd");

#--------------------------------------------------
# actions for cups-update event
#--------------------------------------------------

$event = "cups-update";

templates2events("/etc/logrotate.d/cups", $event);
templates2events("/etc/cups/mime.convs", $event);
templates2events("/etc/cups/mime.types", $event);
templates2events("/etc/cups/cupsd.conf", $event);
templates2events("/etc/samba/smb.conf", $event);
safe_symlink("sigterm", "root/etc/e-smith/events/$event/services2adjust/cupsd");
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/smbd");
